{% extends 'base.html' %} 
{% load static %}
{% load catalog_tags %}
{% block content %} 
<!-- фильтр -->
<div class="container">
  <div class="d-flex row">
    <div class="col-0 col-lg-3"></div>
    <div class="col-12 col-lg-6 my-catalog-filter">
      <form method="get">
        <div class="d-flex mb-3 search-container">
          <div class="d-flex">
            <div class="input-box my-search-box">
              <input
                class="form-control"
                type="text"
                name="query"
                
                {% if input_value %}
                value="{{ input_value }}"
                {% endif %}
                  
              />
              <img src="{% static 'catalog/images/search.svg' %}" class="my-search-icon" />
            </div>
          </div>
          <div class="d-flex">
            <div>
              <button type="submit" class="border my-border my-btn-search btn-right">Поиск</button>
            </div>
          </div>
        </div>
      </form>
    </div>
    <div class="col-0 col-lg-3"></div>
  </div>
</div>
{% include 'catalog/includes/list_bikes.html' %}
<div class="container">
  <nav class="list-pages">
    <ul>
  
      <li class="page-num">
        
        {% if input_value %}
        <a class="border my-border" href="?query={{input_value}}&page=1">&laquo;</a>
        {% else %}
        <a class="border my-border" href="?page=1">&laquo;</a>
        {% endif %}
          
      </li>
        
      {% for p in paginator.page_range %}
      
      {% if page_obj.number == p %}
      <li class="page-num page-num-selected">{{ p }}</li>
      {% elif p >= page_obj.number|add:-1 and p <= page_obj.number|add:1 %}
      <li class="page-num">
        
        {% if input_value %}
        <a class="border my-border" href="?query={{input_value}}&page={{ p }}">{{ p }}</a>
        {% else %}
        <a class="border my-border" href="?page={{ p }}">{{ p }}</a>
        {% endif %}
          
      </li>
      {% elif p == page_obj.number|add:-2 or p == page_obj.number|add:2%}
      <li class="page-num d-none d-md-inline-block d-lg-inline-block">
        
        {% if input_value %}
        <a class="border my-border" href="?query={{input_value}}&page={{ p }}">{{ p }}</a>
        {% else %}
        <a class="border my-border" href="?page={{ p }}">{{ p }}</a>
        {% endif %}
          
      </li>
      {% endif %}
        
      {% endfor %}

      <li class="page-num">
        
        {% if input_value %}
        <a class="border my-border" href="?query={{input_value}}&page={{ page_obj.paginator.num_pages }}">&raquo;</a>
        {% else %}
        <a class="border my-border" href="?page={{ page_obj.paginator.num_pages }}">&raquo;</a>
        {% endif %}
          
      </li>
        
    </ul>
  </nav>
</div>

<script type="text/javascript" src="{% static 'catalog/js/catalog_filter.js' %}"></script>

{% block javascript %}
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <script>
      $(document).ready(function () {
          $('form[name=formFavorite]').submit(function () {
              $.ajax({
                  data: $(this).serialize(),
                  url: "{% url 'favourites' %}",
                  type: "POST",
                  dataType: "json",
                  success: function (response) {
                      if (response.is_taken == true) {
                        if (response.is_added == true){
                          $('#clickOnHeartFavorite' + response.bike_selected).attr('src', "{% static 'catalog/images/grad_heart.svg' %}");
                          $('#clickOnBtnFavorite'+ response.bike_selected).removeClass('btn-primary').addClass('btn-outline-primary');
                          $('#clickOnBtnFavorite'+ response.bike_selected).text('В избранном');
                        }
                        else {
                          $('#clickOnHeartFavorite'+ response.bike_selected).attr('src', "{% static 'catalog/images/black_heart.svg' %}");
                          $('#clickOnBtnFavorite'+ response.bike_selected).removeClass('btn-outline-primary').addClass('btn-primary');
                          $('#clickOnBtnFavorite'+ response.bike_selected).text('В избранное');
                        }
                      }
                  }
              });
              return false;
          });
      })
  </script>

{% endblock javascript %}

{% endblock %}
